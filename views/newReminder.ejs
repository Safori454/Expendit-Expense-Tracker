<%- include('partials/header', { title: 'New reminder' }) %>

<div class="page-head">
  <div>
    <h1 class="h1">Create new reminder</h1>
    <p class="muted">Pick a list, add an optional note, and choose a future date/time.</p>
  </div>
  <div class="page-actions">
    <a class="btn btn-ghost" href="/reminders">Back</a>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <form id="newReminderForm" class="form" action="/reminders/new" method="POST">
      <div class="field">
        <label class="label" for="list_id">List</label>
        <select class="select" id="list_id" name="list_id" required>
          <% lists.forEach(list => { %>
            <option value="<%= list.id %>"><%= list.listname %></option>
          <% }) %>
        </select>
      </div>

      <div class="field">
        <label class="label" for="message">Message (optional)</label>
        <input class="input" id="message" type="text" name="message" placeholder="Add a note or reference" />
      </div>

      <div class="field">
        <label class="label" for="email">Email</label>
        <input class="input" type="email" name="email" id="email" required placeholder="Your email" />
      </div>

      <div class="form-row">
        <div class="field">
          <label class="label" for="date">Date</label>
          <input class="input" id="date" type="date" name="date" required />
        </div>
        <div class="field">
          <label class="label" for="time">Time</label>
          <input class="input" id="time" type="time" name="time" required />
        </div>
      </div>

      <button class="btn btn-primary" type="submit">Create reminder</button>
    </form>
  </div>
</div>

<!-- Prevent past date/time -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("newReminderForm");
    const dateInput = document.querySelector("input[name='date']");
    const timeInput = document.querySelector("input[name='time']");

    if (!form || !dateInput || !timeInput) return;

    form.addEventListener("submit", (e) => {
      const date = dateInput.value;
      const time = timeInput.value;

      if (!date || !time) return;

      const chosen = new Date(`${date} ${time}`);
      const now = new Date();

      if (chosen <= now) {
        e.preventDefault();
        alert("You cannot set a reminder in the past. Please choose a future date and time.");
      }
    });
  });
</script>

<%- include('partials/footer') %>
