<%- include('partials/header', { title: 'Email exports' }) %>

<div class="page-head">
  <div>
    <h1 class="h1">Email exports</h1>
    <p class="muted">Export first, then open your email app to attach the file.</p>
  </div>
  <div class="page-actions">
    <a class="btn btn-ghost" href="/cvtExcel/email">Refresh</a>
    <form method="POST" action="/cvtExcel">
      <button class="btn btn-ghost" type="submit">Back to exports</button>
    </form>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <form class="form" action="/cvtExcel/download" method="POST">
      <div class="field">
        <label class="label" for="listname">Select a list</label>
        <select class="select" name="listname" id="listname">
          <option value="">All Lists</option>
          <% lists.forEach(list => { %>
            <option value="<%= list.listname %>"><%= list.listname %></option>
          <% }); %>
        </select>
      </div>

      <div class="page-actions">
        <button class="btn btn-primary" type="submit" formaction="/cvtExcel/download">Export Excel</button>
        <button class="btn" type="submit" formaction="/export-pdf">Export PDF</button>
      </div>
    </form>

    <div class="spacer-16"></div>

    <div class="alert">
      After downloading the Excel or PDF, click below to open your email app and attach the file manually.
    </div>
    <div class="spacer-12"></div>
    <button class="btn btn-ghost" id="openMailBtn" type="button">Open email app</button>
  </div>
</div>

<script>
  const btn = document.getElementById("openMailBtn");
  if (btn) {
    btn.addEventListener("click", function () {
      const subject = encodeURIComponent("Expense List Export");
      const body = encodeURIComponent("Hi,\\n\\nAttached is the exported expense list. Please check.\\n\\n- Expendit App");
      window.location.href = `mailto:?subject=${subject}&body=${body}`;
    });
  }
</script>

<%- include('partials/footer') %>
