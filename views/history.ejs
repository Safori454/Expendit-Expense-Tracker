<%- include('partials/header', { title: 'History' }) %>

<div class="page-head">
  <div>
    <h1 class="h1">History</h1>
    <p class="muted">Review your saved lists and manage past entries.</p>
  </div>
  <div class="page-actions">
    <form action="/history/clear" method="POST" onsubmit="return confirm('Are you sure you want to clear all history?');">
      <button class="btn btn-danger" type="submit">Clear history</button>
    </form>
    <form method="POST" action="/newlist">
      <button class="btn btn-primary" type="submit">New list</button>
    </form>
  </div>
</div>

<% if (!lists || lists.length === 0) { %>
  <div class="card">
    <div class="card-body">
      <div class="alert">No saved lists yet.</div>
    </div>
  </div>
<% } else { %>
  <div class="card">
    <div class="card-body">
      <div class="table-wrap">
        <table class="table">
          <thead>
            <tr>
              <th>List</th>
              <th class="td-center">Items</th>
              <th>Created</th>
              <th class="td-right">Total</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% lists.forEach(function(list) { %>
              <tr>
                <td><strong><%= list.listname %></strong></td>
                <td class="td-center"><%= list.items ? list.items.length : 0 %></td>
                <td><%= list.created_at ? new Date(list.created_at).toLocaleString() : "—" %></td>
                <td class="td-right">GH₵ <%= Number(list.total || 0).toFixed(2) %></td>
                <td>
                  <div class="table-actions">
                    <a class="btn btn-sm" href="/history/data?listname=<%= encodeURIComponent(list.listname) %>">View</a>
                    <form action="/history/deletelist" method="POST" onsubmit="return confirm('Delete this entire list?');">
                      <input type="hidden" name="listname" value="<%= list.listname %>" />
                      <button class="btn btn-danger btn-sm" type="submit">Delete</button>
                    </form>
                  </div>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
<% } %>

<%- include('partials/footer') %>

